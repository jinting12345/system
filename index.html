<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç™»å…¥ (é™¤éŒ¯æ¨¡å¼)</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/supabase/2.39.7/supabase.min.js"></script>
    
    <style>
        body { font-family: "Microsoft JhengHei", sans-serif; background: #f0f2f5; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        .login-box { background: white; padding: 40px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); width: 100%; max-width: 360px; text-align: center; }
        h2 { color: #1a73e8; margin-bottom: 20px; }
        input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; }
        
        /* æŒ‰éˆ•æ”¹æˆç´…è‰²ï¼Œè®“æ‚¨ä¸€çœ¼ç¢ºèªæ˜¯å¦æ›´æ–° */
        button { width: 100%; padding: 12px; background: #d32f2f; color: white; border: none; border-radius: 6px; font-size: 16px; cursor: pointer; margin-top: 10px; transition: 0.3s; font-weight: bold;}
        button:hover { background: #b71c1c; }
        button:disabled { background: #ccc; cursor: not-allowed; }
        .error { color: red; font-size: 14px; margin-top: 10px; min-height: 20px; word-wrap: break-word;}
    </style>
</head>
<body>
    <div class="login-box">
        <h2>ğŸ¥ ç³»çµ±ç™»å…¥ (é™¤éŒ¯ç‰ˆ)</h2>
        <input type="email" id="email" placeholder="å¸³è™Ÿ">
        <input type="password" id="password" placeholder="å¯†ç¢¼">
        
        <button onclick="handleLogin()" id="loginBtn">ğŸ”´ æ¸¬è©¦ç™»å…¥</button>
        
        <div id="msg" class="error"></div>
    </div>

    <script>
        // 1. åˆå§‹åŒ–è¨­å®š
        // ä½¿ç”¨ var é¿å…èˆŠç€è¦½å™¨ç›¸å®¹æ€§å•é¡Œ
        var RAW_URL = 'https://oipnjnwootorawargsxe.supabase.co';
        var RAW_KEY = 'sb_publishable_3KbpnkaYl5CxJufjrLKlAQ_0-nzCIII'; 
        var supabase = null;

        // 2. æª¢æŸ¥ Supabase æ˜¯å¦è¼‰å…¥
        // é€™æ¬¡å¦‚æœæ²’è¼‰å…¥ï¼Œæœƒç›´æ¥åœ¨ã€ŒæŒ‰éˆ•ä¸‹æ–¹ã€é¡¯ç¤ºç´…å­—
        try {
            if (typeof window.supabase === 'undefined') {
                document.getElementById('msg').innerText = "âŒ éŒ¯èª¤ï¼šSupabase æœªè¼‰å…¥ (CDN è¢«é˜»æ“‹)";
            } else {
                supabase = window.supabase.createClient(RAW_URL, RAW_KEY);
                console.log("Supabase OK");
            }
        } catch (e) {
            document.getElementById('msg').innerText = "âŒ åˆå§‹åŒ–å¤±æ•—ï¼š" + e.message;
        }

        // 3. ç™»å…¥å‡½å¼
        async function handleLogin() {
            // ğŸ”¥ ç¬¬ä¸€æ­¥ï¼šç›´æ¥å½ˆçª—ï¼Œè­‰æ˜æŒ‰éˆ•æ˜¯æ´»çš„
            alert("ğŸ‘† æŒ‰éˆ•æœ‰åæ‡‰ï¼æ­£åœ¨æª¢æŸ¥é€£ç·š...");

            var email = document.getElementById('email').value.trim();
            var password = document.getElementById('password').value.trim();
            var btn = document.getElementById('loginBtn');
            var msg = document.getElementById('msg');

            // æª¢æŸ¥ supabase
            if (!supabase) {
                alert("â›” ç¨‹å¼åº«æœªè¼‰å…¥ï¼\nè«‹æª¢æŸ¥ Kiwi ç€è¦½å™¨çš„ã€Œæ“´å……åŠŸèƒ½ã€æˆ–ã€Œéš±ç§è¨­å®šã€æ˜¯å¦æ“‹ä½äº†è…³æœ¬ã€‚");
                return;
            }
            
            if (!email || !password) {
                msg.innerText = "è«‹è¼¸å…¥å¸³è™Ÿå¯†ç¢¼";
                return;
            }

            btn.disabled = true; 
            btn.innerText = "é€£ç·šä¸­..."; 
            msg.innerText = "";
            
            try {
                const { data, error } = await supabase.auth.signInWithPassword({ 
                    email: email, 
                    password: password 
                });
                
                if (error) {
                    alert("âŒ ç™»å…¥å¤±æ•—ï¼š" + error.message);
                    msg.innerText = "ç™»å…¥å¤±æ•—: " + error.message;
                    btn.disabled = false; 
                    btn.innerText = "ğŸ”´ æ¸¬è©¦ç™»å…¥";
                } else {
                    alert("âœ… ç™»å…¥æˆåŠŸï¼æº–å‚™è·³è½‰...");
                    msg.style.color = "green";
                    msg.innerText = "ç™»å…¥æˆåŠŸï¼Œè·³è½‰ä¸­...";
                    setTimeout(function() {
                        window.location.href = 'menu.html';
                    }, 500);
                }
            } catch (err) {
                alert("âš ï¸ ç³»çµ±éŒ¯èª¤ï¼š" + err.message);
                msg.innerText = "ç³»çµ±éŒ¯èª¤";
                btn.disabled = false; 
                btn.innerText = "ğŸ”´ æ¸¬è©¦ç™»å…¥";
            }
        }
    </script>
</body>
</html>
