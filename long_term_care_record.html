<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç³»çµ±è¨ºæ–·æ¨¡å¼ (v3.11 æ ¸å¿ƒ)</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script>
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
    </script>
    <style>
        body { font-family: monospace; padding: 20px; background: #2c3e50; color: #fff; }
        .container { max-width: 800px; margin: 0 auto; }
        textarea { width: 100%; height: 500px; background: #000; color: #0f0; padding: 15px; border: 2px solid #f1c40f; font-size: 14px; line-height: 1.6; }
        button { padding: 15px 30px; font-size: 18px; background: #3498db; color: white; border: none; cursor: pointer; width: 100%; margin-bottom: 20px; }
        h2 { color: #f1c40f; border-bottom: 1px solid #7f8c8d; padding-bottom: 10px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ› ï¸ å…¨é¢æƒæè¨ºæ–· (v3.11)</h1>
        <p>è«‹ä¸Šå‚³ PDFï¼Œç³»çµ±å°‡æå–ã€Œå§“åã€åœ°å€ã€ååš¥ã€çš„åŸå§‹ç¢¼çµæ§‹ã€‚</p>
        <input type="file" id="pdf_upload" accept="application/pdf" style="margin-bottom: 20px;">
        <button onclick="runDebug()">â–¶ï¸ åŸ·è¡Œè¨ºæ–·</button>
        
        <h2>è¨ºæ–·å ±å‘Š (è«‹è¤‡è£½ä¸‹æ–¹å…§å®¹)</h2>
        <textarea id="debug_log" readonly>ç­‰å¾…åŸ·è¡Œ...</textarea>
    </div>

<script>
    function log(msg) { 
        const el = document.getElementById('debug_log');
        el.value += msg + "\n";
        el.scrollTop = el.scrollHeight;
    }

    async function runDebug() {
        const fileInput = document.getElementById('pdf_upload');
        if (fileInput.files.length === 0) { alert("è«‹å…ˆé¸æ“‡ PDF!"); return; }
        
        document.getElementById('debug_log').value = "=== è¨ºæ–·é–‹å§‹ (v3.11) ===\n";
        
        try {
            const file = fileInput.files[0];
            const arrayBuffer = await file.arrayBuffer();
            const pdf = await pdfjsLib.getDocument(arrayBuffer).promise;

            let fullText = "";
            // è®€å–å‰ 8 é  (é€šå¸¸åŒ…å«æ‰€æœ‰é—œéµè³‡æ–™)
            for (let i = 1; i <= Math.min(pdf.numPages, 8); i++) {
                const page = await pdf.getPage(i);
                const textContent = await page.getTextContent();
                // ä½¿ç”¨ | åˆ†éš”ï¼Œä¿ç•™æ’ç‰ˆè³‡è¨Š
                const pageText = textContent.items.map(item => item.str).join("|");
                fullText += `[Page ${i}] ${pageText}\n\n`;
            }

            // === 1. å§“å/èº«åˆ†è­‰ å€åŸŸ ===
            log("--- [åŸºæœ¬è³‡æ–™å€] ---");
            const nameIndex = fullText.indexOf("å€‹æ¡ˆå§“å");
            if (nameIndex !== -1) {
                log(fullText.substring(nameIndex, nameIndex + 300));
            } else {
                log("âŒ æ‰¾ä¸åˆ° 'å€‹æ¡ˆå§“å'");
            }

            // === 2. åœ°å€ å€åŸŸ ===
            log("\n--- [åœ°å€å€] ---");
            const addrIndex = fullText.indexOf("æˆ¶ç±åœ°å€");
            if (addrIndex !== -1) {
                log(fullText.substring(addrIndex, addrIndex + 400));
            } else {
                log("âŒ æ‰¾ä¸åˆ° 'æˆ¶ç±åœ°å€'");
            }

            // === 3. ååš¥å›°é›£ (G6a) ===
            log("\n--- [ååš¥ G6a] ---");
            let swallowIndex = fullText.indexOf("G6a");
            if (swallowIndex === -1) swallowIndex = fullText.indexOf("ååš¥èƒ½åŠ›");
            
            if (swallowIndex !== -1) {
                const sContent = fullText.substring(swallowIndex, swallowIndex + 1000);
                log(sContent);
                
                // æª¢æŸ¥ç‰¹æ®Šç¬¦è™Ÿ
                log("\n[ç¬¦è™Ÿæª¢æŸ¥]");
                if (sContent.includes("â˜‘")) log("âœ… ç™¼ç¾ 'â˜‘'");
                if (sContent.includes("â– ")) log("âœ… ç™¼ç¾ 'â– '");
                if (sContent.includes("âœ“")) log("âœ… ç™¼ç¾ 'âœ“'");
                if (!sContent.includes("â˜‘") && !sContent.includes("â– ") && !sContent.includes("âœ“")) log("âŒ ç„¡ä»»ä½•æ‰“å‹¾ç¬¦è™Ÿ");
            } else {
                log("âŒ æ‰¾ä¸åˆ° 'G6a'");
            }

            log("\n=== è¨ºæ–·çµæŸ ===");

        } catch (err) {
            log("éŒ¯èª¤: " + err.message);
        }
    }
</script>
</body>
</html>
