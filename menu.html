<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç³»çµ±é¸å–®</title>
    
    <script type="module">
        import { createClient } from 'https://esm.sh/@supabase/supabase-js@2'
        window.createClient = createClient; // æ›è¼‰åˆ°å…¨åŸŸè®“ä¸‹æ–¹ script ä½¿ç”¨
    </script>

    <style>
        body { font-family: "Microsoft JhengHei", sans-serif; background: #f8f9fa; margin: 0; padding: 20px; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; padding: 0 10px; }
        h2 { margin: 0; color: #333; font-weight: bold; font-size: 1.2em; }
        
        .logout-btn { background: #dc3545; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; font-size: 14px; transition: 0.3s; }
        .logout-btn:hover { background: #bb2d3b; }
        
        .container { max-width: 800px; margin: 0 auto; padding-bottom: 50px; }
        .group-title { color: #555; border-bottom: 2px solid #ddd; padding-bottom: 8px; margin: 30px 0 15px 0; font-weight: bold; font-size: 1.1em; }
        
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 15px; }
        .card { background: white; padding: 20px; border-radius: 8px; text-align: center; text-decoration: none; color: #333; box-shadow: 0 2px 4px rgba(0,0,0,0.05); transition: 0.2s; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 110px; }
        .card:hover { transform: translateY(-3px); box-shadow: 0 4px 12px rgba(0,0,0,0.15); border: 1px solid #1a73e8; color: #1a73e8; }
        .icon { font-size: 32px; margin-bottom: 10px; }
        .card span:last-child { font-weight: bold; font-size: 0.95em; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h2>ğŸ¥ ç¾©å¤§ç‡Ÿé¤Šç§‘è³‡è¨Šç³»çµ±</h2>
            <button id="logoutBtn" class="logout-btn">ç™»å‡º</button>
        </div>

        <div class="group-title">ğŸ± è†³ç®¡çµ„</div>
        <div class="grid">
            <a href="bento.html" class="card">
                <span class="icon">ğŸ“¸</span>
                <span>ä¾¿ç•¶ä¸Šå‚³</span>
            </a>
            <a href="check_records.html" class="card">
                <span class="icon">ğŸ“‹</span>
                <span>æŸ¥çœ‹ç…§ç‰‡ç´€éŒ„</span>
            </a>
            
            <a href="#" class="card" onclick="alert('é–‹ç™¼ä¸­åŠŸèƒ½')">
                <span class="icon">ğŸŒ¡ï¸</span>
                <span>é¤è»Šæº«åº¦ (é–‹ç™¼ä¸­)</span>
            </a>
        </div>

        <div class="group-title">ğŸ©º è‡¨åºŠçµ„</div>
        <div class="grid">
            <a href="contract.html" class="card">
                <span class="icon">ğŸ“</span>
                <span>é•·ç…§å¥‘ç´„æ›¸ç”¢ç”Ÿå™¨</span>
            </a>

            <a href="long_term_care_record.html" class="card">
                <span class="icon">ğŸ–¨ï¸</span>
                <span>é•·ç…§ç´€éŒ„ç´™æœ¬ç™»æ‰“</span>
            </a>

            <a href="inventory_pro.html" class="card">
                <span class="icon">ğŸ“¦</span>
                <span>ç‡Ÿé¤Šå“æ¨£å“ç®¡ç†ç³»çµ±</span>
            </a>
        </div>

        <div class="group-title">âš™ï¸ å…±ç”¨å€</div>
        <div class="grid">
            <a href="upload_schedule.html" class="card">
                <span class="icon">ğŸ“…</span>
                <span>ç­è¡¨ä¸Šå‚³ (Excel)</span>
            </a>

            <a href="admin.html" class="card" style="border: 1px solid #e74c3c; color: #c0392b;">
                <span class="icon">ğŸ”‘</span>
                <span>æ¬Šé™ç®¡ç†ç³»çµ±</span>
            </a>
        </div>
    </div>

    <script type="module">
        const RAW_URL = 'https://oipnjnwootorawargsxe.supabase.co';
        const RAW_KEY = 'sb_publishable_3KbpnkaYl5CxJufjrLKlAQ_0-nzCIII';
        
        let supabase = null;

        // åˆå§‹åŒ–
        window.onload = async () => {
            // ç­‰å¾…ä¸Šé¢çš„ module è¼‰å…¥ createClient
            setTimeout(initSystem, 100);
        };

        function initSystem() {
            try {
                if(window.createClient) {
                    supabase = window.createClient(RAW_URL, RAW_KEY);
                    checkLogin();
                    
                    // ç¶å®šç™»å‡ºæŒ‰éˆ•
                    document.getElementById('logoutBtn').addEventListener('click', handleLogout);
                } else {
                    throw new Error("ç³»çµ±å…ƒä»¶æœªè¼‰å…¥");
                }
            } catch(e) {
                // å¦‚æœå…ƒä»¶è¢«æ“‹ï¼ŒæŒ‰ç™»å‡ºç›´æ¥è·³è½‰å›é¦–é ï¼Œä¸è®“ä½¿ç”¨è€…å¡æ­»
                document.getElementById('logoutBtn').onclick = function() {
                    window.location.href = 'index.html';
                };
                console.warn("ç³»çµ±å—é˜»ï¼Œå•Ÿç”¨å¼·åˆ¶ç™»å‡ºæ¨¡å¼");
            }
        }

        async function checkLogin() {
            const { data } = await supabase.auth.getSession();
            if(!data.session) {
                window.location.href = 'index.html';
            }
        }

        async function handleLogout() {
            if(supabase) {
                try {
                    await supabase.auth.signOut();
                } catch(e) {
                    console.warn("ç™»å‡ºé€£ç·šéŒ¯èª¤ (å¿½ç•¥):", e);
                }
            }
            // ç„¡è«– Supabase æ˜¯å¦æˆåŠŸå›æ‡‰ï¼Œéƒ½å¼·åˆ¶è·³è½‰å›ç™»å…¥é 
            window.location.href = 'index.html';
        }
    </script>
</body>
</html>
